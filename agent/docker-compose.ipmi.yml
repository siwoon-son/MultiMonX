# MultiMonX Agent - IPMI (BMC) add-on
# Use with base agent: docker compose -f docker-compose.yml -f docker-compose.ipmi.yml up -d
# Requires: FreeIPMI/ipmitool on host (로컬 BMC 접근 시)
# platform: linux/amd64 → macOS(ARM/Intel) + Linux 동일 compose로 실행
#
# 포트: .env의 IPMI_EXPORTER_PORT가 호스트 포트 (기본 9290). 컨테이너 내부는 9290 고정.
#   예: IPMI_EXPORTER_PORT=29290 이면 http://호스트:29290/metrics 로 접근

services:
  ipmi_exporter:
    image: prometheuscommunity/ipmi-exporter:latest
    container_name: multimonx-ipmi-exporter
    restart: unless-stopped
    ports:
      - "${IPMI_EXPORTER_PORT:-9290}:9290"
    networks:
      - multimonx
    command:
      - "--web.listen-address=:9290"
    # 로컬 메트릭은 config 없이 수집. 원격/인증 필요 시 config 마운트 후 command에 추가:
    # volumes:
    #   - ./ipmi-config.yml:/etc/ipmi_exporter/config.yml:ro
    # command: ["--config.file=/etc/ipmi_exporter/config.yml", "--web.listen-address=:9290"]
networks:
  multimonx:
    external: true
